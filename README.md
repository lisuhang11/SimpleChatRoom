# 📣 简易聊天室（poll 版）

一个用 C++17 编写的 **单线程、单进程** 聊天室示例，包含：

- **服务器**（`chat_server`）：`poll` 多路复用，支持任意数量的并发客户端
- **客户端**（`chat_client`）：`poll` 同时监听键盘和服务器，实时收发消息

------

## 📦 文件列表

| 文件              | 说明       |      |      |      |      |      |      |      |      |      |      |      |      |      |
| :---------------- | :--------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `chat_server.cpp` | 服务器源码 |      |      |      |      |      |      |      |      |      |      |      |      |      |
| `chat_client.cpp` | 客户端源码 |      |      |      |      |      |      |      |      |      |      |      |      |      |
|                   |            |      |      |      |      |      |      |      |      |      |      |      |      |      |
|                   |            |      |      |      |      |      |      |      |      |      |      |      |      |      |
|                   |            |      |      |      |      |      |      |      |      |      |      |      |      |      |

------

## 🛠️ 编译

Linux / macOS / WSL 均可，确保已安装 **g++**：

```bash
# 安装编译器（CentOS/RHEL）
sudo yum install gcc-c++ -y

# 或 Debian/Ubuntu
sudo apt install g++ -y
```

编译：

```bash
g++ -std=c++17 -O2 chat_server.cpp -o chat_server
g++ -std=c++17 -O2 chat_client.cpp -o chat_client
```



------

## 🚀 运行

### 1️⃣ 启动服务器

```bash
./chat_server 5555
```

> 默认监听 `0.0.0.0:5555`，如端口被占用可换其他端口。

### 2️⃣ 启动客户端（可多开）

```bash
./chat_client 127.0.0.1 5555
```

### 3️⃣ 聊天

- 在任意客户端窗口 **输入文字 + 回车**，即可广播给所有在线用户。
- 收到消息会立即回显。
- 退出：按 **Ctrl-D**（Linux/macOS）或 **Ctrl+Z 回车**（Windows）。

------

## 🧪 示例会话

表格

| 终端 A（客户端）               | 终端 B（客户端）               |      |      |      |      |      |      |      |      |      |      |      |      |      |
| :----------------------------- | :----------------------------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `./chat_client 127.0.0.1 5555` | `./chat_client 127.0.0.1 5555` |      |      |      |      |      |      |      |      |      |      |      |      |      |
| `Alice: hi all ↵`              | `Bob: hello ↵`                 |      |      |      |      |      |      |      |      |      |      |      |      |      |
| 双方均显示：                   | 同上                           |      |      |      |      |      |      |      |      |      |      |      |      |      |

------

## ⚙️ 配置参数

| 参数         | 说明                  | 默认值 |      |      |      |      |      |      |      |      |      |      |      |      |
| :----------- | :-------------------- | :----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `BUF_SIZE`   | 单次最大收发字节      | 4096   |      |      |      |      |      |      |      |      |      |      |      |      |
| `MAX_EVENTS` | poll 同时监控 fd 上限 | 1024   |      |      |      |      |      |      |      |      |      |      |      |      |
| 端口         | 命令行传入            | 5555   |      |      |      |      |      |      |      |      |      |      |      |      |

如需修改，直接编辑源码顶部宏即可。

------

## 🐛 常见问题

| 现象                           | 解决                     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| :----------------------------- | :----------------------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `g++: command not found`       | 安装 `gcc-c++` 或 `g++`  |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| `bind: Address already in use` | 换端口或 `kill` 占用进程 |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| 客户端无回显                   | 确保按 **回车** 发送整行 |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
| 连接不上                       | 检查防火墙 / IP / 端口   |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |

------

## 📄 许可证

MIT — 随意修改、分发、商用。

